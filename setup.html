<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  
</body>
<script>
function mountComponent(vnode,container,anchor){
  const  componentOptions = vnode.type
  let {render,data,setup} = componentOptions
  beforeCreate && beforeCreate()

  const state = data ? reactive(data()) : null
  const [props,attrs] = resolveProps(componentOptions.props,vnode.props)
  const instance = {
    state,
    vnode,
    props: shallowReactive(props),
    isMounted: false,
    subTree: null,
  }
  
  const setupContext = { attrs }
  const setupResult = setup(shallowReadonly(instance.props), setupContext)
  // setup返回的是一个render函数
  // setupState 储存setup返回的对象
  let setupState = null
  if (typeof setupResult === 'function') {
    // 报告冲突
    if(render){
      console.error('render function has been defined in setup()')
    }
    render = setupResult
  } else {
    setupState = setupResult
  }

  vnode.component = instance

}

const renderContext = new Proxy(instance, {
  get(target, key) {
    if (key in target.props) {
      return target.props[key]
    } else if (key in target.state) {
      return target.state[key]
    } else if (key in target.setupState){
      return target.setupState[key]
    }
  },
  set(target, key, value) {
    if (key in target.props) {
      target.props[key] = value
    } else if (key in target.state) {
      target.state[key] = value
    } else if (key in target.setupState){
      target.setupState[key] = value
    }
  }
})

</script>
</html>